<!DOCTYPE html>
<html>
<head>
    <title>Chess Bot</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard-1.0.0.min.css">
    <style>
        body { background: #1a1a1a; color: white; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; }
        #board { width: 400px; margin-top: 20px; }
        .controls { margin-top: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        button { padding: 10px; cursor: pointer; }
        #status { margin: 10px; color: #00ffcc; }
    </style>
</head>
<body>

    <div id="status">Loading...</div>
    <div id="board"></div>

    <div class="controls">
        <button onclick="toggleBot()" id="botBtn">ðŸ¤– Bot: OFF</button>
        <button onclick="board.flip()">ðŸ”„ Flip</button>
        <button onclick="game.reset(); board.start();">Reset</button>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard-1.0.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>

    <script>
        var board = null;
        var game = new Chess();
        var botEnabled = false;
        var stockfish = new Worker('https://cdnjs.cloudflare.com/ajax/libs/stockfish.js/10.0.2/stockfish.js');

        function onDrop(source, target) {
            var move = game.move({ from: source, to: target, promotion: 'q' });
            if (move === null) return 'snapback';
            updateStatus();
            if (botEnabled) setTimeout(makeBotMove, 250);
        }

        function makeBotMove() {
            stockfish.postMessage('position fen ' + game.fen());
            stockfish.postMessage('go depth 10');
            stockfish.onmessage = function(event) {
                if (event.data.includes('bestmove')) {
                    var move = event.data.split(' ')[1];
                    game.move({ from: move.substring(0,2), to: move.substring(2,4), promotion: 'q' });
                    board.position(game.fen());
                    updateStatus();
                }
            };
        }

        function toggleBot() {
            botEnabled = !botEnabled;
            document.getElementById('botBtn').innerHTML = botEnabled ? "ðŸ¤– Bot: ON" : "ðŸ¤– Bot: OFF";
        }

        function updateStatus() {
            var status = game.in_checkmate() ? "Checkmate!" : (game.turn() === 'w' ? "White to move" : "Black to move");
            document.getElementById('status').innerHTML = status;
        }

        board = ChessBoard('board', {
            draggable: true,
            position: 'start',
            onDrop: onDrop,
            // This ensures images load from a reliable source
            pieceTheme: 'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png'
        });
        updateStatus();
    </script>
</body>
</html>
